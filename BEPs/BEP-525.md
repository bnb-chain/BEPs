<pre>
  BEP: 525
  Title: Validator Dedicated Network
  Status: Draft
  Type: Standards
  Created: 2025-02-19
  Discussions(optional): https://forum.bnbchain.org/t/idea-faster-p2p-network-for-validators/3282
</pre>

# BEP-525: Validator Dedicated Network
- [BEP-525: Validator Dedicated Network](#bep-525-validator-dedicated-network)
  - [1. Summary](#1-summary)
  - [2. Motivation](#2-motivation)
  - [3. Specification](#3-specification)
    - [3.1.Validator Dedicated Network(VDN)](#31validator-dedicated-networkvdn)
    - [3.2.Directional Transactions Broadcast](#32directional-transactions-broadcast)
  - [4. Backwards Compatibility](#4-backwards-compatibility)
  - [5. License](#5-license)

## 1. Summary
Add a network layer, which accept validator or validator authorized node to join in to improve the network efficiency and reduce network latency between validators.

## 2. Motivation
Low latency is one of the key user experience and if BSC wanna to support shorter block interval, network latency between validators could be crucial to support sub-second block interval. Current P2P gossip based network is good at broadcasting blocks/transactions to the whole network, but it is not efficient enough, i.e. it would take lots network bandwidth and also cost non-negligible latency. Validators are the key player to sustain the network, so one validator dedicated network layer could help to address the two issues.

## 3. Specification
### 3.1.Validator Dedicated Network(VDN)
The general network layout is described in the bellow diagram, basically validators would be able to be connected directly, so the latency can be reduced. 

There would be some new roles in VDN:
- BootNode: it is help validators to discover each other and establish the connection, and only validators registered with the staking contract are allowed to connect.
- Validator Node: join the network through bootnode, discover all validators in the network, connect to active validator nodes, and exchange messages.
- Validator-RPC-Sentry: transactions can be sent to this sentry node and it will forward it to the corresponding validator nodes.
- Validator-Proxy: in is optional, in case validator donâ€™t wanna expose itself to public network, it could authoerise one or more proxy nodes to connect to the VDN.

![overview](./assets/BEP-525/3-1.png)

### 3.2.Directional Transactions Broadcast
It is another key aspect of VDN, transactions that are broadcasted in VDN would no long gossip based, on the opposite, they will only be broadcasted to nextN validators which have the right to propose next block.

In order to receive transactions from SentryProxy or RPC Provider, the sender needs to implement a batch send transaction. This can be done by using JSON-RPC batch request implementation with `eth_sendRawTransaction`. The receiver only receives transactions in batches and must not package the incoming transactions as a bundler.

### 3.3.Messages

It is recommended to use the QUIC protocol to send messages and broadcast messages based on the pubsub mechanism. All messages are RLP encoded.

#### handshake v1
Protocol ID: `/bsc/vdn/v1/handshake`

Request & Response Content:

```
(
  chainID: uint64
  forkID: [4]byte
  genesis_hash: Hash
  timestamp: Time
  extend: []byte
  pub_key: PublicKey
  sign: Signature
)
```

Node must check `chainID`, `forkID`, `genesis_hash`, and `extend` is empty now. Only validators registered with the staking contract are allowed to connect.

#### ContactInfo v1
Protocol ID: `/bsc/vdn/v1/contact_info`

Request Content:

```
(
  listen_p2p_addrs: []Address // validator can connect other validator with these addresses.
  listen_tx_addrs: []Address // RPC provider or Sentry Proxy can batch send txs with these url.
  cache: []Concact // max 8 cache node's contact
  timestamp: Time
)
```

Response Content:

```
(
  code: StatusCode
)
```

Node will broadcast its ContactInfo periodly.

#### Block v1
Protocol ID: `/bsc/vdn/v1/block`

Request Content:

```
(
  block: Block
  timestamp: Time
)
```

Response Content:

```
(
  code: StatusCode
)
```

#### RequestBlockByRange v1
Protocol ID: `/bsc/vdn/v1/req/block_by_range`

Request Content:

```
(
  start_height: uint64
  count: uint64
  timestamp: Time
)
```

Response Content:

```
(
  code: StatusCode
  blocks: []Block
)
```

#### Vote v1
Protocol ID: `/bsc/vdn/v1/vote`

Request Content:

```
(
  vote: Vote
  timestamp: Time
)
```

Response Content:

```
(
  code: StatusCode
)
```

#### Transactions v1
Protocol ID: `/bsc/vdn/v1/Transactions`

Request Content:

```
(
  txs: []Transaction // not exist 10MB in total msg size
  timestamp: Time
)
```

Response Content:

```
(
  code: StatusCode
)
```

## 4. Backwards Compatibility
TBD

## 5. License
The content is licensed under [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
