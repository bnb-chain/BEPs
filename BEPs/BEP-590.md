```markdown
  BEP: 590
  Title: Extended Voting Rules for Fast Finality Stability
  Status: Draft
  Type: Standards
  Created: 2025-06-25
  Description: Enhance the robustness of Fast Finality by extending validator voting logic and aggregate vote inclusion rules.
```

# BEP-590: Extended Voting Rules for Fast Finality Stability

- [BEP-590: Extended Voting Rules for Fast Finality Stability](#bep-590-extended-voting-rules-for-fast-finality-stability)
    - [1. Summary](#1-summary)
    - [2. Abstract](#2-abstract)
    - [3. Motivation](#3-motivation)
    - [4. Specification](#4-specification)
      - [4.1 Validator Vote Rule 3 Changes](#41-validator-vote-rule-3-changes)
      - [4.2 Aggregate Vote Rule Changes](#42-aggregate-vote-rule-changes)
    - [5. Security](#5-security)
    - [6. Backward Compatibility](#6-backward-compatibility)
    - [7. License](#7-license)

---

### 1. Summary

This BEP proposes coordinated extensions to both the validator voting logic and aggregate vote inclusion rules in the Fast Finality (FF) protocol of the BNB Smart Chain. These changes aim to improve the stability and liveness of Fast Finality under adverse network conditions, reduce the need for throughput-limiting behaviors, and support further reductions in block interval.

---

### 2. Abstract

[BEP-126](./BEP126.md) introduced Fast Finality as a mechanism for deterministic block finalization in BNB Smart Chain. Under the original design:

* Validators always vote for the latest block
* Proposers (miners) may only aggregate votes for their direct parent block

This BEP extends both mechanisms:

1. **Validator Voting Rule Extension** — Allow validators to vote for blocks up to two heights behind the current chain head, using the latest justified block as the vote source. This helps sustain finalization progress even when vote propagation or inclusion is delayed.
2. **Aggregate Vote Inclusion Extension** — Allow proposers to include votes for up to three recent ancestor blocks, improving tolerance to vote propagation latency.

Together, these adjustments enhance the resilience of Fast Finality during periods of network congestion, without modifying the core consensus model or cryptographic assumptions.

---

### 3. Motivation

As transaction volume increases, validators often experience latency in receiving, verifying, and casting votes for blocks. Such delays can lead to missing justifications, which in turn hinders finalization.

To mitigate this, miners may adopt suboptimal strategies such as reducing block sizes or sealing time—both of which negatively affect throughput. Additionally, as block intervals shorten, inter-region network latency becomes a more prominent bottleneck in vote propagation.

This BEP addresses these issues by introducing:

* **Smarter validator voting logic** — to sustain finalization progress even when votes are not timely included
* **More flexible vote aggregation** — to increase the chances of including valid votes despite network delays

Together, these changes reduce finality gaps and support performance improvements without compromising safety.

---

### 4. Specification

This BEP introduces coordinated modifications to:

* **Validator Vote Rules** (Section 4.1)
* **Aggregate Vote Inclusion Rules** (Section 4.2)

---

#### 4.1 Validator Vote Rule 3 Changes

To maintain finalization even when vote inclusion is delayed, we revise `Validator Vote Rule 3` from [BEP-126](./BEP126.md) as follows:

```go
if  latestBlock aggregates votes successfully &&
    finalizedNumber + 1 != justifiedNumber &&
    justifiedNumber + 1 >= latestNumber - 2:
    vote for justifiedNumber + 1  // child of the latest justified block
else:
    vote for latestNumber
```

This rule allows validators to vote for a block up to two heights behind the current head, provided it is a descendant of the latest justified block. This helps bridge short-term vote propagation delays and ensures progress toward finality.

For example, if votes for block N arrive during the sealing of block N+2, voting and justification progress can continue as follows:

| Block Mined | Aggregated Votes | Validator Vote (Post Verify) | Latest Justified | Latest Finalized |
| ----------- | ---------------- | ---------------------------- | ---------------- | ---------------- |
| 3           | -                | 0 → 3                        | 0                | 0                |
| 4           | -                | 0 → 4                        | 0                | 0                |
| 5           | 0 → 3            | 3 → 4                        | 3                | 0                |
| 6           | -                | 3 → 6                        | 3                | 0                |
| 7           | 3 → 4            | 4 → 7                        | 4                | 3                |
| 8           | -                | 4 → 8                        | 4                | 3                |
| 9           | 4 → 7            | 7 → 8                        | 7                | 3                |
| 10          | -                | 7 → 10                       | 7                | 3                |
| 11          | 7 → 8            | 8 → 11                       | 8                | 7                |

This update enhances protocol liveness while preserving the original safety properties.

---

#### 4.2 Aggregate Vote Rule Changes

To improve vote inclusion under delayed network conditions, this rule allows proposers to aggregate votes for recent ancestor blocks. The process proceeds in the following order:

1. Attempt to aggregate votes for the **immediate parent block**
2. If unavailable, try the **grandparent block**
3. If still unavailable, try the **great-grandparent block**

The process **must stop** once any valid vote is found and included. At most one ancestor block's votes may be included in a single proposal.

This rule gives validators up to three block intervals to propagate their votes, improving the success rate of vote inclusion and reducing justification gaps during periods of latency.

---

### 5. Security

This BEP does **not** alter the core safety assumptions or mechanisms of Fast Finality defined in [BEP-126](./BEP126.md). Specifically, it **does not change**:

* **Validator Vote Rules 1 and 2** — which govern when and how validators may issue votes
* **Finality Rules** — including thresholds for justification and finalization
* **Longest Chain Rule** — the fork-choice rule determining canonical chain selection

This proposal only modifies:

* **Validator Vote Rule 3** — to improve finalization liveness
* **Vote aggregation scope** — to improve vote inclusion flexibility

All original safety guarantees, including one-block finality under an honest supermajority, remain **intact**.

---

### 6. Backward Compatibility

This BEP is **not backward compatible** with older clients, as it changes both the validator voting logic and vote aggregation behavior. However, it introduces no changes to protocol-level message formats or user-facing APIs.

A full client upgrade across validators and block producers is required to activate the changes and maintain consensus.

---

### 7. License

The content is licensed under [Creative Commons CC0 1.0 Universal License](https://creativecommons.org/publicdomain/zero/1.0/).

---