<pre>
  BEP: 520
  Title: Short Block Interval
  Status: Draft
  Type: Standards
  Created: 2025-02-10
  Description: To shorten the block interval from 3s to 1.5s.
</pre>

# BEP-520: Short Block Interval
- [BEP-520: Short Block Interval](#bep-520-short-block-interval)
  - [1. Summary](#1-summary)
  - [2. Abstract](#2-abstract)
  - [3. Motivation](#3-motivation)
  - [4. Specification](#4-specification)
    - [4.1 Parlia Changes](#41-parlia-changes)
      - [4.1.1 Millisecond Representation in Block Header](#411-millisecond-representation-in-block-header)
      - [4.1.2 Penalizing Intentional Block Production Delays](#412-penalizing-intentional-block-production-delays)
    - [4.2 Parameters Changes](#42-parameters-changes)
  - [5. Other Significant Impacts](#5-other-significant-impacts)
  - [6. License](#6-license)

## 1. Summary
To shorten the block interval from 3s to 1.5s, so transactions can be confirmed faster to deliver better user experience.

## 2. Abstract
BSCâ€™s 3 seconds block internal has never been changed since its creation. But shorter block internal is attractive to deliver even faster transaction confirmation time, which is a key aspect of user experience. But a short block interval would also bring several challenges to the chain.

## 3. Motivation
Shorten the block interval to reduce the time it takes for transactions to be included and confirmed.

## 4. Specification
### 4.1 Parlia Changes
#### 4.1.1 Millisecond Representation in Block Header
Before the implementation of this BEP, both block intervals and block times were represented with a minimum unit of `second`. Post - BEP, the minimum unit is changed to `millisecond`.

Regarding the representation of block time, to maintain maximum compatibility, the unit of `Header.Time` remains `second`. The `millisecond` component is stored in the last two bytes of `Header.ParentBeaconRoot`. The following Go code snippets illustrate how this is achieved:
```Go
// SetMilliseconds can be called once millisecond representation supported
func (h *Header) SetMilliseconds(milliseconds uint64) {
	tmp := common.Hash(uint256.NewInt(milliseconds % 1000).Bytes32())
	h.ParentBeaconRoot = &tmp
}

func (h *Header) Milliseconds() uint64 {
	if h.ParentBeaconRoot == nil || *h.ParentBeaconRoot == (common.Hash{}) {
		return 0
	}
	return uint256.NewInt(0).SetBytes2(h.ParentBeaconRoot[30:]).Uint64()
}

func (h *Header) TimeInMilliseconds() uint64 {
	return h.Time*1000 + h.Milliseconds()
}
```

#### 4.1.2 Penalizing Intentional Block Production Delays
In the Parlia engine, each block height has a designated in-turn validator responsible for producing the block. If the in-turn validator fails to produce the block in time, a second-priority validator will take over after a delay equal to `initialBackOffTime`.
Current settings:
```Go
  blockInterval     = uint64(3) // second
  initialBackOffTime= uint64(1) // second
```
The in-turn validator can delay block production to just below `initialBackOffTime` without worrying about competition from the second-priority validator. As the block interval decreases, the proportion of production time that the in-turn validator can unfairly "steal" increases.

This behavior needs to be penalized. In a continuous block production scenario, such cases are easy to identify. The penalty mechanism reallocates all transaction fee rewards (except the portion that is burned) to the `SystemRewardContract`.

The detection condition is as follows:
```Go
func (p *Parlia) isBlockDelayMinedOnPurpose(header, parent *types.Header) {
    return header.Coinbase == parent.Coinbase &&
        parent.TimeInMilliseconds() + blockInterval < header.TimeInMilliseconds()
}
```

### 4.2 Parameters Changes
A multitude of system parameters are configured based on the assumption that the default block interval is 3 seconds. Consequently, when the block interval is altered, these parameters must be adjusted accordingly:
| parameter |type | current value|new value |
|--------|--------|--------|--------|
|Epoch  |client parameter |200  |1000|
|GasLimit |client parameter|140M |60M|
|Blob Target  |client parameter |3  |2|
|Blob Maximum |client parameter |6  |3|
|Blob MinBlocksForBlobRequests  |client parameter |524288 |1048576=524288*2|
|BSCGovernor.votingDelay  |contract parameter | * |votingDelay*2|
|BSCGovernor.votingPeriod |contract parameter |*  |votingPeriod*2|
|BSCGovernor.minPeriodAfterQuorum |contract parameter |*  |minPeriodAfterQuorum*2 |
|BSCValidatorSet.misdemeanorThreshold |contract parameter |*  |misdemeanorThreshold*2|
|BSCValidatorSet.felonyThreshold  |contract parameter |*  |felonyThreshold*2|
|BSCValidatorSet.felonySlashScope |contract parameter |*  |felonySlashScope*2|
|BSCValidatorSet.TurnLength  |contract parameter |4  |24  |

## 5. Other Significant Impacts
The [Quarterly Auto-Burn](https://www.bnbburn.info/) mechanism also requires adjustment.

## 6. License
The content is licensed under [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
