<pre>
  BEP: 520
  Title: Short Block Interval
  Status: Draft
  Type: Standards
  Created: 2025-02-10
  Description: To shorten the block interval from 3 seconds to 0.75 seconds.
</pre>

# BEP-520: Short Block Interval
- [BEP-520: Short Block Interval](#bep-520-short-block-interval)
  - [1. Summary](#1-summary)
  - [2. Abstract](#2-abstract)
  - [3. Motivation](#3-motivation)
  - [4. Specification](#4-specification)
    - [4.1 Parlia Changes](#41-parlia-changes)
      - [4.1.1 Millisecond Representation in Block Header](#411-millisecond-representation-in-block-header)
      - [4.1.2 Penalizing Intentional Block Production Delays](#412-penalizing-intentional-block-production-delays)
    - [4.2 Parameters Changes](#42-parameters-changes)
      - [4.2.1 Change table](#421-change-table)
  - [5. Rational](#5-rational)
    - [5.1 Epoch and TurnLength](#51-epoch-and-turnlength)
    - [5.2 GasLimit and GasLimitBoundDivisor](#52-gaslimit-and-gaslimitbounddivisor)
    - [5.3 Blob Related](#53-blob-related)
    - [5.4 Contract Parameters](#54-contract-parameters)
  - [6. Backward Compatibility](#6-backward-compatibility)
    - [6.1 MEV](#61-mev)
    - [6.2 Layer 2 Solutions](#62-layer-2-solutions)
    - [6.3 Quarterly Auto-Burn](#63-quarterly-auto-burn)
  - [7. License](#7-license)

## 1. Summary
Shorten the block interval from 3 seconds to 0.75 seconds to enable faster transaction confirmations and improve user experience.

## 2. Abstract
Since its inception, BSC has maintained a 3-second block interval. Shortening this interval can provide quicker transaction confirmations, enhancing user experience. However, this modification presents challenges that require adjustments to the consensus mechanism and network parameters.

## 3. Motivation
In a competitive blockchain landscape, users demand faster transaction confirmations. Reducing the block interval will make BSC more competitive and meet user expectations for high-performance blockchains.

## 4. Specification
The block interval will be gradually reduced through two hard forks. The first reduction will decrease it from 3 seconds to 1.5 seconds, and the second reduction will decrease it from 1.5 seconds to 0.75 seconds.
### 4.1 Parlia Changes
#### 4.1.1 Millisecond Representation in Block Header
Before the implementation of this BEP, both block intervals and block times were represented with a minimum unit of `second`. Post - BEP, the minimum unit is changed to `millisecond`.

Regarding the representation of block time, to maintain maximum compatibility, the unit of `Header.Time` remains `second`. The `millisecond` component is stored in the last two bytes of `Header.ParentBeaconRoot`. The following Go code snippets illustrate how this is achieved:
```Go
// SetMilliseconds can be called once millisecond representation supported
func (h *Header) SetMilliseconds(milliseconds uint64) {
	tmp := common.Hash(uint256.NewInt(milliseconds % 1000).Bytes32())
	h.ParentBeaconRoot = &tmp
}

func (h *Header) Milliseconds() uint64 {
	if h.ParentBeaconRoot == nil || *h.ParentBeaconRoot == (common.Hash{}) {
		return 0
	}
	return uint256.NewInt(0).SetBytes2(h.ParentBeaconRoot[30:]).Uint64()
}

func (h *Header) TimeInMilliseconds() uint64 {
	return h.Time*1000 + h.Milliseconds()
}
```

#### 4.1.2 Penalizing Intentional Block Production Delays
In the Parlia engine, each block height has a designated in-turn validator responsible for producing the block. If the in-turn validator fails to produce the block in time, a second-priority validator will take over after a delay equal to `initialBackOffTime`.
Current settings:
```Go
  blockInterval     = uint64(3) // second
  initialBackOffTime= uint64(1) // second
```
The in-turn validator can delay block production to just below `initialBackOffTime` without worrying about competition from the second-priority validator. As the block interval decreases, the proportion of production time that the in-turn validator can unfairly "steal" increases.

This behavior needs to be penalized. In a continuous block production scenario, such cases are easy to identify. The penalty mechanism reallocates all transaction fee rewards (except the portion that is burned) to the `SystemRewardContract`.

The detection condition is as follows:
```Go
func (p *Parlia) isBlockDelayMinedOnPurpose(header, parent *types.Header) {
    return header.Coinbase == parent.Coinbase &&
        parent.TimeInMilliseconds() + blockInterval < header.TimeInMilliseconds()
}
```

### 4.2 Parameters Changes
#### 4.2.1 Change table
A multitude of system parameters are configured based on the assumption that the default block interval is 3 seconds. Consequently, when the block interval is altered, these parameters must be adjusted accordingly:
|parameter |type |current value  |first hardfork |second hardfork|
|--------|--------|--------|--------|--------|
|Epoch  |client parameter |200  |1000 |1000|
|GasLimit |client parameter |140M |65M |30M|
|GasLimitBoundDivisor |client parameter |256 |1024 |1024|
|Blob Target  |client parameter |3  |2  |1|
|Blob Maximum |client parameter |6  |3  |2|
|Blob Update Fraction |client parameter |3338477  |5007716  |3338477|
|Blob MinBlocksForBlobRequests  |client parameter |524288 |1048576 (524288 × 2) |2097152 (524288 × 4)|
|BSCGovernor.votingDelay  |contract parameter |$votingDelay |$votingDelay × 2  |$votingDelay × 4|
|BSCGovernor.votingPeriod |contract parameter |$votingPeriod  |$votingPeriod × 2 |$votingPeriod × 4|
|BSCGovernor.minPeriodAfterQuorum |contract parameter |$minPeriodAfterQuorum  |$minPeriodAfterQuorum × 2 |$minPeriodAfterQuorum × 4 |
|BSCValidatorSet.misdemeanorThreshold |contract parameter |$misdemeanorThreshold  |$misdemeanorThreshold × 2 |$misdemeanorThreshold × 4|
|BSCValidatorSet.felonyThreshold  |contract parameter |$felonyThreshold  |$felonyThreshold × 2  |$felonyThreshold × 4|
|BSCValidatorSet.felonySlashScope |contract parameter |$felonySlashScope  |$felonySlashScope × 2 |$felonySlashScope × 4|
|BSCValidatorSet.TurnLength  |contract parameter |4  |16  |16|
## 5. Rational
### 5.1 Epoch and TurnLength
Within an epoch, some validators may fail to produce blocks as scheduled due to maintenance, system failures, or other issues. This can lead to an increased number of low-difficulty blocks, reducing network stability. When a new epoch begins, the validator set is adjusted, replacing validators that have repeatedly failed to produce blocks as scheduled to maintain network stability. Therefore, the epoch duration must not be too long, or the network’s stability will degrade.

Since validators now produce blocks consecutively, the epoch length should be set so that each validator has an approximately equal number of block production opportunities within an epoch.

At validator set transition points, a validator can deliberately delay broadcasting its block. As long as the delay does not exceed the predefined `initialBackOffTime`, the delayed block will still be accepted by the network. Increasing `BSCValidatorSet.TurnLength` effectively mitigates this issue.

Considering these factors, the epoch length is set to 1000, and `TurnLength` to 16. When the block interval is ultimately reduced to 0.75 seconds, the epoch duration will increase from 600 to 750 seconds. A 1000-block epoch roughly allows 21 validators to produce three full rounds of 16 blocks each.

### 5.2 GasLimit and GasLimitBoundDivisor
As the block interval shortens, the gas limit per block must decrease accordingly. However, since not all time within a block interval is used for transaction processing, the gas limit is reduced slightly more than the proportional decrease in block interval. The gas limit is initially set to decrease to 65M in the first hard fork and to 30M in the second.

GasLimitBoundDivisor represents the rate of change in GasLimit. Since the block interval is reduced by a factor of four, GasLimitBoundDivisor is increased by the same factor to maintain a consistent rate of GasLimit adjustment.
### 5.3 Blob Related
This BEP implementation aims to maintain or enhance the network’s capacity to handle blobs. According to the table, before the first hard fork, the network handles a target of 1 blob per second (3/3). After the second hard fork, this increases to 4/3 blobs per second (1/0.75), representing a 33% improvement in blob processing capacity.

The target-to-max ratio from EIP-4844 was originally 1:2. After the first hard fork, it changed to 2:3, and after the second hard fork, it reverted to 1:2. Referencing [EIP-7691](https://github.com/ethereum/EIPs/blob/d96625a4dcbbe2572fa006f062bd02b4582eefd5/EIPS/eip-7691.md#update-fraction), the Blob Update Fraction was set to 5,007,716 and 3,338,477 for the first and second hard forks, respectively.

### 5.4 Contract Parameters
The seven parameters—`BSCGovernor.votingDelay`, `BSCGovernor.votingPeriod`, `BSCGovernor.minPeriodAfterQuorum`, `BSCValidatorSet.misdemeanorThreshold`, `BSCValidatorSet.felonyThreshold`, `BSCValidatorSet.felonySlashScope`, and `Blob MinBlocksForBlobRequests`—are all measured in block numbers and used to calculate time. Therefore, when the block interval is reduced, the block numbers must be increased proportionally to maintain the same time representation.

## 6. Backward Compatibility
### 6.1 MEV
When the block interval is reduced to 0.75 seconds, a single validator still produces 16 consecutive blocks per turn, maintaining the total continuous block production time at 12 seconds (0.75 × 16). However, the reduced time within each block significantly shortens the collaboration window for searchers, builders, and validators, affecting the current process and necessitating adjustments.

### 6.2 Layer 2 Solutions
With BSC’s blob-handling capacity increased by 1/3, the required blob support for L2 solutions has also been enhanced.

### 6.3 Quarterly Auto-Burn
The [Quarterly Auto-Burn](https://www.bnbburn.info/) mechanism also requires adjustment,The block count in the formula is replaced with time, resulting in the new formula:
<div align="center">
<img src=./assets/bep-520/5-3.png width=60% />
</div>
where T represents the number of seconds in the corresponding quarter.

## 7. License
The content is licensed under [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
